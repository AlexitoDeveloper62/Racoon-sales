<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Racoon Multiservice</title>
  <style>
    /* Your CSS here (paste/keep your updated styles) */
  </style>
</head>
<body>
  <header>
    <h1>Racoon Multiservice</h1>
    <p>Your gateway to amazing products from trusted companies.</p>
  </header>

  <button id="editButton">Editar contenido</button>

  <div id="loginBox">
    <h3>Inicio de sesión</h3>
    <input type="text" id="username" placeholder="Usuario" />
    <button id="loginBtn">Entrar</button>
  </div>

  <main>
    <section class="gallery">
      <div class="card" data-slot="1">
        <img alt="Slot 1" />
        <div class="controls">
          <label for="upload1">Add</label>
          <input type="file" id="upload1" accept="image/*" hidden />
          <button class="remove-btn">Remove</button>
        </div>
        <input type="text" class="link-input" placeholder="Enter link (https://...)" />
        <div class="link-display"></div>
      </div>
      <div class="card" data-slot="2">
        <img alt="Slot 2" />
        <div class="controls">
          <label for="upload2">Add</label>
          <input type="file" id="upload2" accept="image/*" hidden />
          <button class="remove-btn">Remove</button>
        </div>
        <input type="text" class="link-input" placeholder="Enter link (https://...)" />
        <div class="link-display"></div>
      </div>
      <div class="card" data-slot="3">
        <img alt="Slot 3" />
        <div class="controls">
          <label for="upload3">Add</label>
          <input type="file" id="upload3" accept="image/*" hidden />
          <button class="remove-btn">Remove</button>
        </div>
        <input type="text" class="link-input" placeholder="Enter link (https://...)" />
        <div class="link-display"></div>
      </div>
      <div class="card" data-slot="4">
        <img alt="Slot 4" />
        <div class="controls">
          <label for="upload4">Add</label>
          <input type="file" id="upload4" accept="image/*" hidden />
          <button class="remove-btn">Remove</button>
        </div>
        <input type="text" class="link-input" placeholder="Enter link (https://...)" />
        <div class="link-display"></div>
      </div>
      <div class="card" data-slot="5">
        <img alt="Slot 5" />
        <div class="controls">
          <label for="upload5">Add</label>
          <input type="file" id="upload5" accept="image/*" hidden />
          <button class="remove-btn">Remove</button>
        </div>
        <input type="text" class="link-input" placeholder="Enter link (https://...)" />
        <div class="link-display"></div>
      </div>
    </section>
    <p class="note">To buy, please click the link under each picture.</p>
  </main>

  <footer>&copy; 2025 Racoon Multiservice. All rights reserved.</footer>
  
  <!-- Google APIs JS -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    // Your Sheets info
    const SHEET_ID = "10CD1tdzFXI-Sdvvi3rEF5OLmCjdr3_QOA3oQTfwhhvc";
    const API_KEY = "AIzaSyBzJfgSEcypczZWdv8siP0ThHjbknW5fhY";
    let loggedIn = false;

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
      }).then(loadData, err=>console.error("initClient error",err));
    }
    gapi.load('client', initClient);

    function loadData() {
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SHEET_ID,
        range: "Sheet1!A2:C6"
      }).then(resp=>{
        const values = resp.result.values || [];
        document.querySelectorAll('.card').forEach((card, idx)=>{
          const img = card.querySelector('img');
          const linkDisplay = card.querySelector('.link-display');
          const linkInput = card.querySelector('.link-input');
          const row = values[idx]||[];
          const imageUrl = row[1]||"";
          const productLink = row[2]||"";
          img.src = imageUrl || `https://via.placeholder.com/250x180.png?text=Slot+${idx+1}`;
          linkDisplay.innerHTML = productLink ? `<a href="${productLink}" target="_blank" rel="noopener">Go to link</a>` : "";
          if(loggedIn && linkInput) linkInput.value = productLink||"";
        });
      }).catch(err=>{
        console.error("Error loading Sheets data:",err);
      });
    }

    function saveData(slot,imageUrl,linkUrl){
      const row = parseInt(slot)+1;
      const values=[[slot,imageUrl||"",linkUrl||""]];
      gapi.client.sheets.spreadsheets.values.update({
        spreadsheetId:SHEET_ID,
        range:`Sheet1!A${row}:C${row}`,
        valueInputOption:'RAW',
        resource:{values:values}
      }).then(()=>loadData())
      .catch(err=>{console.error("Error saving to Sheets",err);alert("Error guardando en Sheets");});
    }

    // Login logic
    const loginBox = document.getElementById("loginBox");
    const editButton = document.getElementById("editButton");
    editButton.addEventListener("click", () => {
      if (!loggedIn) loginBox.style.display = "block";
    });
    document.getElementById("loginBtn").addEventListener("click", () => {
      const user = document.getElementById("username").value.trim();
      if (user === "teacheralex62") {
        loggedIn = true;
        loginBox.style.display = "none";
        document.querySelectorAll(".controls, .link-input").forEach(el => el.style.display = "flex");
        loadData();
        alert("Modo edición activado ✅");
      } else {
        alert("Usuario incorrecto ❌");
      }
    });

    document.querySelectorAll('.card').forEach((card,idx)=>{
      const slot = card.dataset.slot;
      const img = card.querySelector('img');
      const uploadInput = card.querySelector('input[type="file"]');
      const removeBtn = card.querySelector('.remove-btn');
      const linkInput = card.querySelector('.link-input');
      const linkDisplay = card.querySelector('.link-display');

      uploadInput.addEventListener('change',e=>{
        if(!loggedIn) return alert("Solo el usuario puede editar.");
        const file=e.target.files[0];
        if(!file) return;
        const reader=new FileReader();
        reader.onload=ev=>{
          const dataUrl=ev.target.result; // base64 URL
          saveData(slot,dataUrl,linkInput.value||"");
        };
        reader.readAsDataURL(file);
      });

      removeBtn.addEventListener('click',()=>{
        if(!loggedIn) return alert("Solo el usuario puede editar.");
        img.src=`https://via.placeholder.com/250x180.png?text=Slot+${slot}`;
        saveData(slot,"",linkInput.value||"");
      });

      linkInput.addEventListener('change',()=>{
        if(!loggedIn) return alert("Solo el usuario puede editar.");
        saveData(slot,img.src||"",linkInput.value||"");
        linkDisplay.innerHTML=linkInput.value?`<a href="${linkInput.value}" target="_blank" rel="noopener">Go to link</a>`:"";
      });
    });

    // Auto-refresh every 5s (read-only mode)
    setInterval(()=>{if(!loggedIn)loadData();},5000);

  </script>
</body>
</html>